global
log /dev/log local0
log /dev/log local1 notice
daemon
maxconn 20000
tune.ssl.default-dh-param 2048

defaults
log global
mode http
option httplog
option dontlognull
timeout connect 5000ms
timeout client 50000ms
timeout server 50000ms

# HTTP frontend: redirect all to HTTPS with 301

frontend http_front
bind \*:80
mode http # Transparent to user, permanent redirect
http-request redirect scheme https code 301 if !{ ssl_fc }

# HTTPS frontend (SSL termination)

frontend https_front
bind \*:443 ssl crt /etc/letsencrypt/live/www.YOUR_DOMAIN/fullchain.pem /etc/letsencrypt/live/www.holberton.online/privkey.pem
mode http
option forwardfor
http-request set-header X-Forwarded-Proto https
default_backend web_back

backend web_back
mode http
balance roundrobin
server web-01 10.0.0.11:80 check
server web-02 10.0.0.12:80 check
